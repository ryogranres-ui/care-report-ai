<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Care Report AI｜共有・報告サポート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
  <header class="app-header">
    <div class="app-header-inner">
      <div>
        <h1 class="app-title">Care Report AI</h1>
        <p class="app-subtitle">
          介護現場の「共有・報告」を、かんたん＆高品質にするAIツール
        </p>
      </div>
      <div class="mode-switch">
        <label for="modeSelect" class="mode-label">モード</label>
        <select id="modeSelect" class="mode-select">
          <option value="report">共有・報告モード</option>
          <option value="instruction">指示モード（※今後拡張予定）</option>
        </select>
      </div>
    </div>
    <p id="modeDescription" class="mode-description">
      利用者の事故・状態変化・家族連絡などを、管理者や看護師に正確に伝える報告文を作成します。
    </p>
  </header>

  <main class="app-main">
    <section class="layout">
      <!-- 左カラム：入力エリア -->
      <div class="column column-left">

        <!-- AIヒアリングモード -->
        <section class="card card-dialogue">
          <div class="card-header">
            <span class="step-badge step-badge-alt">ASK</span>
            <h2 class="card-title">AIヒアリングモード（質問に答えるだけ）</h2>
          </div>
          <p class="card-description">
            まずは、今の状況を1〜2行でざっくり教えてください。<br />
            その内容をもとに、AIが必要なことを順番に質問します。
          </p>

          <div class="form-group">
            <label for="dialogueSeed" class="field-label">いま起きていること（1〜2行）</label>
            <textarea
              id="dialogueSeed"
              class="input-textarea"
              rows="2"
              placeholder="例）◯◯様がトイレから戻る途中でふらつきがあり、ベッド手前で膝をつくように倒れました。頭部打撲はなく、少し膝の痛みを訴えています。"
            ></textarea>
            <p class="field-hint" id="dialogueHint">
              例のように、ざっくりで構いません。難しく考えなくてOKです。
            </p>
          </div>

          <div class="actions actions-right">
            <button type="button" id="btnStartDialogue" class="btn btn-primary">
              AIに質問してもらう
            </button>
          </div>

          <div id="dialogueArea" class="dialogue-log">
            <!-- AIの質問と職員の回答が積み上がる -->
          </div>

          <div id="dialogueAnswerArea" class="dialogue-answer-area" style="display:none;">
            <label for="dialogueAnswerInput" class="field-label">AIからの質問への回答</label>
            <textarea
              id="dialogueAnswerInput"
              class="input-textarea"
              rows="2"
              placeholder="ここに回答を入力して「回答を送信」を押してください。"
            ></textarea>
            <div class="actions">
              <button type="button" id="btnSendAnswer" class="btn btn-secondary">
                回答を送信
              </button>
              <button type="button" id="btnFinishDialogue" class="btn btn-outline">
                この内容で報告文を作成
              </button>
            </div>
          </div>
        </section>

        <!-- かんたん入力モード -->
        <section class="card card-quick">
          <div class="card-header">
            <span class="step-badge">SHORT</span>
            <h2 class="card-title">かんたん入力（3行でAIに任せる）</h2>
          </div>
          <p class="card-description">
            忙しいときは、ここに要点だけ3〜5行で書けばOKです。<br />
            AIが「共有・報告」または「指示」用の文章を自動で組み立てます。
          </p>

          <div class="quick-tags">
            <p class="field-label">カテゴリ（あてはまるものをタップ）</p>
            <div class="quick-tag-list">
              <button type="button" class="quick-tag" data-tag="体調変化">体調変化</button>
              <button type="button" class="quick-tag" data-tag="転倒・ケガ">転倒・ケガ</button>
              <button type="button" class="quick-tag" data-tag="発熱">発熱</button>
              <button type="button" class="quick-tag" data-tag="家族からの連絡">家族からの連絡</button>
              <button type="button" class="quick-tag" data-tag="物品・設備トラブル">物品・設備トラブル</button>
              <button type="button" class="quick-tag" data-tag="その他">その他</button>
            </div>
          </div>

          <div class="quick-tags">
            <p class="field-label">目的</p>
            <div class="quick-tag-list">
              <button type="button" class="quick-tag" data-tag="観察依頼">観察依頼</button>
              <button type="button" class="quick-tag" data-tag="ケア方法の変更相談">ケア方法の変更相談</button>
              <button type="button" class="quick-tag" data-tag="受診の相談">受診の相談</button>
              <button type="button" class="quick-tag" data-tag="家族への共有">家族への共有</button>
              <button type="button" class="quick-tag" data-tag="記録のための共有">記録のための共有</button>
            </div>
          </div>

          <div class="form-group">
            <label for="quickBullets" class="field-label">要点メモ（3〜5行）</label>
            <textarea
              id="quickBullets"
              class="input-textarea"
              rows="4"
              placeholder="例）&#10;・17時ごろ、◯◯様がトイレから出る際にふらつきあり&#10;・ベッドに戻る途中で膝をつくように倒れた（頭部打撲なし）&#10;・その後も会話は普段通りで、痛みは軽度と訴えあり"
            ></textarea>
            <p class="field-hint">
              ・1行につき「1つの事実」を書くイメージで入力してください。<br />
              ・書きやすい順番でOKです。AIが順番を並べ替えます。
            </p>
          </div>

          <div class="actions actions-right">
            <button type="button" id="btnQuickGenerate" class="btn btn-primary">
              この要点から報告／指示文をつくる
            </button>
          </div>
        </section>

        <!-- STEP1 基本情報（＋折りたたみバイタル） -->
        <section class="card">
          <div class="card-header">
            <span class="step-badge">STEP 1</span>
            <h2 class="card-title">基本情報</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="reporterName" class="field-label">作成者名</label>
              <input id="reporterName" class="input-text" type="text" placeholder="例）山田（早番）" />
            </div>

            <div class="form-group">
              <label for="userName" class="field-label">対象利用者／対象者</label>
              <input id="userName" class="input-text" type="text" placeholder="例）◯◯ ◯◯ 様（○号室）" />
              <p id="hint-userName" class="field-hint">
                対象者が特定できるように、名前＋居室番号などを書いてください。
              </p>
            </div>

            <div class="form-group">
              <label for="eventDateTime" class="field-label">日時</label>
              <input id="eventDateTime" class="input-text" type="datetime-local" />
              <p id="hint-eventDateTime" class="field-hint">
                起きた日時、または気づいた日時を記載してください。
              </p>
            </div>

            <div class="form-group">
              <label for="eventPlace" class="field-label">場所</label>
              <input id="eventPlace" class="input-text" type="text" placeholder="例）◯階食堂／◯階トイレ前" />
              <p id="hint-eventPlace" class="field-hint">
                施設内のどの場所で起きたか、分かる範囲で書いてください。
              </p>
            </div>

            <!-- 折りたたみバイタル -->
            <details class="vital-details">
              <summary class="vital-summary">バイタル（必要時のみ）</summary>
              <div class="vital-grid">
                <div class="vital-item">
                  <span class="vital-label">体温（BT）</span>
                  <input id="tempInput" type="number" step="0.1" class="input-text" placeholder="例）37.8" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">血圧（収縮）</span>
                  <input id="bpSysInput" type="number" class="input-text" placeholder="例）132" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">血圧（拡張）</span>
                  <input id="bpDiaInput" type="number" class="input-text" placeholder="例）74" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">脈拍（P）</span>
                  <input id="pulseInput" type="number" class="input-text" placeholder="例）88" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">SpO2</span>
                  <input id="spo2Input" type="number" class="input-text" placeholder="例）97" />
                </div>
              </div>
              <p id="hint-vital" class="field-hint">
                測定している場合のみ記入してください。数値がない場合は空欄で構いません。
              </p>
            </details>
          </div>
        </section>

        <!-- STEP2 内容 -->
        <section class="card">
          <div class="card-header">
            <span class="step-badge">STEP 2</span>
            <h2 class="card-title">内容</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label id="label-summary" for="summary" class="field-label">概要（ひとことで言うと？）</label>
              <textarea
                id="summary"
                class="input-textarea"
                rows="2"
                placeholder="例）◯◯様がトイレから戻る際にふらつきがあり、転倒はなかったが膝を強く打った可能性がある。"
              ></textarea>
              <p id="hint-summary" class="field-hint">
                一言で「何があったのか」「何を伝えたいのか」を書いてください。
              </p>
            </div>

            <div class="form-group">
              <label id="label-details" for="details" class="field-label">詳しい状況・経過</label>
              <textarea
                id="details"
                class="input-textarea"
                rows="4"
                placeholder="例）いつ・どこで・誰が・何をしているときに・どうなったか、時系列で書いてください。"
              ></textarea>
              <p id="hint-details" class="field-hint">
                「直前の様子 → 起きたこと → その後の様子」の順で書くと分かりやすくなります。
              </p>
            </div>

            <div class="form-group">
              <label id="label-actions" for="actions" class="field-label">実施した対応／具体的な指示内容</label>
              <textarea
                id="actions"
                class="input-textarea"
                rows="3"
                placeholder="例）バイタル測定、患部の確認、家族・主治医への連絡、夜勤者への申し送り内容 など。"
              ></textarea>
              <p id="hint-actions" class="field-hint">
                すでに行った対応や、現場職員にお願いしたい具体的な行動を書いてください。
              </p>
            </div>

            <div class="form-group">
              <label id="label-goal" for="goal" class="field-label">今後の対応・ゴール／報告ライン</label>
              <textarea
                id="goal"
                class="input-textarea"
                rows="3"
                placeholder="例）どの状態になったら報告が必要か、どこまで行えば完了か を明確に。"
              ></textarea>
              <p id="hint-goal" class="field-hint">
                「誰が・いつまでに・どの程度まで行えば完了か」「どこに報告するか」を書いてください。
              </p>
            </div>
          </div>
        </section>

        <!-- STEP3 追加情報（違和感のみ） -->
        <section class="card">
          <div class="card-header">
            <span class="step-badge">STEP 3</span>
            <h2 class="card-title">追加情報（任意）</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="concern" class="field-label">職員として感じた違和感・気になる点</label>
              <textarea
                id="concern"
                class="input-textarea"
                rows="3"
                placeholder="例）いつもより会話量が少ない、反応が遅い、普段と違う訴えがある など。"
              ></textarea>
              <p id="hint-concern" class="field-hint">
                「なんとなくいつもと違う」「気になっていること」があれば、遠慮なく書いてください。
              </p>
            </div>
          </div>
        </section>

        <!-- ボタン群 -->
        <section class="card card-actions">
          <div class="card-body">
            <div class="actions actions-stack">
              <button type="button" id="btnGenerate" class="btn btn-secondary">
                AI用の文章を作る
              </button>
              <button type="button" id="btnEvaluate" class="btn btn-primary">
                管理者目線でチェックしてもらう
              </button>
            </div>
            <p id="errorMessage" class="error-message" style="display:none;"></p>
          </div>
        </section>
      </div>

      <!-- 右カラム：出力エリア -->
      <div class="column column-right">
        <!-- ローカルスコア -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">入力充実度（ローカルスコア）</h2>
          </div>
          <div class="card-body">
            <div class="local-score">
              <div class="local-score-main">
                <span class="local-score-value" id="localScoreValue">-</span>
                <span class="local-score-unit">点 / 100</span>
              </div>
              <div class="local-score-level" id="localScoreLevel">
                まだ評価が行われていません。
              </div>
            </div>
            <pre id="localScoreDetail" class="local-score-detail"></pre>
          </div>
        </section>

        <!-- AIに渡す文章 -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">AIに渡す文章（施設内申し送り・他システム転記用）</h2>
          </div>
          <div class="card-body">
            <pre id="generatedReport" class="generated-report"></pre>
          </div>
        </section>

        <!-- AIフィードバック（管理者目線）＋トグル -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">AIからの管理者目線フィードバック</h2>
          </div>
          <div class="card-body">
            <div class="ai-score">
              <span class="ai-score-label">AIスコア</span>
              <span class="ai-score-value" id="aiScoreValue">-</span>
              <span class="ai-score-unit">点 / 100</span>
            </div>
            <div class="education-toggle">
              <label>
                <input type="checkbox" id="toggleEducation" checked />
                新人向けポイントを表示する
              </label>
            </div>
            <div id="aiFeedback" class="ai-feedback"></div>
          </div>
        </section>

        <!-- AIによる書き直し例（全文） -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">AIによる書き直し例（全文）</h2>
          </div>
          <div class="card-body">
            <details class="rewrite-block">
              <summary>書き直し例を表示</summary>
              <pre id="aiRewrite" class="ai-rewrite"></pre>
            </details>
          </div>
        </section>

        <!-- AIが整えた文章カード（編集用） -->
        <section class="card" id="aiRewriteCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">AIが整えた文章（編集して使えます）</h2>
          </div>
          <div class="card-body">
            <p class="card-description">
              そのままコピーして他システムに貼り付けても、ここで微修正してから使ってもOKです。
            </p>
            <textarea id="aiRewriteText" class="output-textarea" rows="10"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyRewrite" class="btn btn-secondary">
                この文章をコピーする
              </button>
              <button type="button" id="btnApplyRewrite" class="btn btn-outline">
                上の「AIに渡す文章」に反映する
              </button>
            </div>
          </div>
        </section>

        <!-- 短い申し送り用（3行バージョン） -->
        <section class="card" id="aiShortCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">短い申し送り用（3行バージョン）</h2>
          </div>
          <div class="card-body">
            <p class="card-description">
              夜勤・引き継ぎ・口頭申し送りでそのまま使える、要点だけの3行です。
            </p>
            <textarea id="aiShortText" class="output-textarea" rows="3"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyShort" class="btn btn-secondary">
                この3行をコピーする
              </button>
            </div>
          </div>
        </section>

        <!-- 新人向けポイント（教育用） -->
        <section class="card" id="educationCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">新人向けポイント（教育用メモ）</h2>
          </div>
          <div class="card-body">
            <p class="card-description">
              このケースで新人さんが押さえておくと良い「専門表現・観察ポイント・対応・報告ライン・危険サイン」などのまとめです。
            </p>
            <textarea id="educationText" class="output-textarea" rows="8"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyEducation" class="btn btn-secondary">
                この新人向けポイントをコピーする
              </button>
            </div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <p>Care Report AI / GRANRES Inc.</p>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
