<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Care Report AI｜共有・報告サポート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
  <header class="app-header">
    <div class="app-header-inner">
      <div>
        <h1 class="app-title">Care Report AI</h1>
        <p class="app-subtitle">
          介護現場の「共有・報告」を、かんたん＆高品質にするAIツール
        </p>
      </div>
      <div class="mode-switch">
        <label for="modeSelect" class="mode-label">モード</label>
        <select id="modeSelect" class="mode-select">
          <option value="report">共有・報告モード</option>
          <option value="instruction">指示モード（※今後拡張予定）</option>
        </select>
      </div>
    </div>
    <p id="modeDescription" class="mode-description">
      利用者の事故・状態変化・家族連絡などを、管理者や看護師に正確に伝える報告文を作成します。
    </p>
  </header>

  <main class="app-main">
    <section class="layout">
      <!-- 左カラム：入力（STEP1・STEP2） -->
      <div class="column column-left">

        <!-- STEP1 基本情報 -->
        <section class="card">
          <div class="card-header">
            <span class="step-badge">STEP 1</span>
            <h2 class="card-title">基本情報</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="reporterName" class="field-label">作成者名</label>
              <input id="reporterName" class="input-text" type="text" placeholder="例）山田（早番）" />
            </div>

            <div class="form-group">
              <label for="userName" class="field-label">対象利用者／対象者</label>
              <input id="userName" class="input-text" type="text" placeholder="例）◯◯ ◯◯ 様（○号室）" />
              <p id="hint-userName" class="field-hint">
                対象者が特定できるように、名前＋居室番号などを書いてください。
              </p>
            </div>

            <div class="form-group">
              <label for="eventDateTime" class="field-label">日時</label>
              <input id="eventDateTime" class="input-text" type="datetime-local" />
              <p id="hint-eventDateTime" class="field-hint">
                起きた日時、または気づいた日時を記載してください。
              </p>
            </div>

            <div class="form-group">
              <label for="eventPlace" class="field-label">場所</label>
              <input id="eventPlace" class="input-text" type="text" placeholder="例）◯階食堂／◯階トイレ前" />
              <p id="hint-eventPlace" class="field-hint">
                施設内のどの場所で起きたか、分かる範囲で書いてください。
              </p>
            </div>

            <!-- ▼ バイタル（折りたたみ） -->
            <details class="vital-details">
              <summary class="vital-summary">バイタル（必要時のみ）</summary>
              <div class="vital-grid">
                <div class="vital-item">
                  <span class="vital-label">体温（BT）</span>
                  <input id="tempInput" type="number" step="0.1" class="input-text" placeholder="例）37.8" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">血圧（収縮）</span>
                  <input id="bpSysInput" type="number" class="input-text" placeholder="例）132" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">血圧（拡張）</span>
                  <input id="bpDiaInput" type="number" class="input-text" placeholder="例）74" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">脈拍（P）</span>
                  <input id="pulseInput" type="number" class="input-text" placeholder="例）88" />
                </div>
                <div class="vital-item">
                  <span class="vital-label">SpO2</span>
                  <input id="spo2Input" type="number" class="input-text" placeholder="例）97" />
                </div>
              </div>
              <p id="hint-vital" class="field-hint">
                測定している場合のみ記入してください。数値がない場合は空欄で構いません。
              </p>
            </details>
          </div>
        </section>

        <!-- STEP2 AIヒアリング -->
        <section class="card card-dialogue">
          <div class="card-header">
            <span class="step-badge step-badge-alt">STEP 2</span>
            <h2 class="card-title">AIヒアリングモード（質問に答えるだけ）</h2>
          </div>
          <p class="card-description">
            まずは、今の状況を1〜2行でざっくり教えてください。<br />
            その内容をもとに、AIが必要なことを順番に質問します。
          </p>

          <div class="form-group">
            <label for="dialogueSeed" class="field-label">いま起きていること（1〜2行）</label>
            <textarea
              id="dialogueSeed"
              class="input-textarea"
              rows="2"
              placeholder="例）◯◯様が食事を全量拒否されています。嘔吐はなく、水分は少量なら摂取できますが、いつもより表情が乏しく元気がありません。"
            ></textarea>
            <p class="field-hint" id="dialogueHint">
              例のように、ざっくりで構いません。難しく考えなくてOKです。
            </p>
          </div>

          <div class="actions actions-right">
            <button type="button" id="btnStartDialogue" class="btn btn-primary">
              AIに質問してもらう
            </button>
          </div>

          <div id="dialogueArea" class="dialogue-log">
            <!-- AIの質問と職員の回答が積み上がる -->
          </div>

          <div id="dialogueAnswerArea" class="dialogue-answer-area" style="display:none;">
            <label for="dialogueAnswerInput" class="field-label">AIからの質問への回答</label>
            <textarea
              id="dialogueAnswerInput"
              class="input-textarea"
              rows="2"
              placeholder="ここに回答を入力して「回答を送信」を押してください。"
            ></textarea>
            <div class="actions">
              <button type="button" id="btnSendAnswer" class="btn btn-secondary">
                回答を送信
              </button>
              <button type="button" id="btnFinishDialogue" class="btn btn-outline">
                この内容で報告文を作成
              </button>
            </div>
          </div>

        </section>

        <!-- エラーメッセージ（共通） -->
        <section class="card">
          <div class="card-body">
            <p id="errorMessage" class="error-message" style="display:none;"></p>
          </div>
        </section>
      </div>

      <!-- 右カラム：STEP3 出力 -->
      <div class="column column-right">
        <!-- 入力充実度 -->
        <section class="card">
          <div class="card-header">
            <span class="step-badge">STEP 3</span>
            <h2 class="card-title">出力・フィードバック</h2>
          </div>
          <div class="card-body">
            <div class="local-score">
              <div class="local-score-main">
                <span class="local-score-value" id="localScoreValue">-</span>
                <span class="local-score-unit">点 / 100</span>
              </div>
              <div class="local-score-level" id="localScoreLevel">
                まだ評価が行われていません。
              </div>
            </div>
            <pre id="localScoreDetail" class="local-score-detail"></pre>
          </div>
        </section>

        <!-- 施設内共有向けの文章（黒画面：最終版） -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">施設内共有向けの文章</h2>
          </div>
          <div class="card-body">
            <pre id="generatedReport" class="generated-report"></pre>
          </div>
        </section>

        <!-- 管理者目線フィードバック ＋ 新人トグル -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">AIからの管理者目線フィードバック</h2>
          </div>
          <div class="card-body">
            <div class="education-toggle">
              <label>
                <input type="checkbox" id="toggleEducation" checked />
                新人向けポイントを表示する
              </label>
            </div>
            <div id="aiFeedback" class="ai-feedback"></div>
          </div>
        </section>

        <!-- 編集可能なAI文章 -->
        <section class="card" id="aiRewriteCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">AIが整えた文章（編集して使えます）</h2>
          </div>
          <div class="card-body">
            <textarea id="aiRewriteText" class="output-textarea" rows="10"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyRewrite" class="btn btn-secondary">
                この文章をコピーする
              </button>
              <button type="button" id="btnApplyRewrite" class="btn btn-outline">
                上の共有文章に反映する
              </button>
            </div>
          </div>
        </section>

        <!-- 3行要約 -->
        <section class="card" id="aiShortCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">短い申し送り用（3行バージョン）</h2>
          </div>
          <div class="card-body">
            <textarea id="aiShortText" class="output-textarea" rows="3"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyShort" class="btn btn-secondary">
                この3行をコピーする
              </button>
            </div>
          </div>
        </section>

        <!-- 新人向けポイント -->
        <section class="card" id="educationCard" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">新人向けポイント（教育用メモ）</h2>
          </div>
          <div class="card-body">
            <textarea id="educationText" class="output-textarea" rows="8"></textarea>
            <div class="actions">
              <button type="button" id="btnCopyEducation" class="btn btn-secondary">
                この新人向けポイントをコピーする
              </button>
            </div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <p>Care Report AI / GRANRES Inc.</p>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
